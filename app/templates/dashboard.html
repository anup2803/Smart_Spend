{%extends 'master.html' %}
{% block title %}Dashboard - Smart Spend{% endblock %}
 {%block content%}
     <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
     <style>
    #myChart {
        max-width: 300px;   /* Shrinks width */
        max-height: 300px;  /* Shrinks height */
    }
</style>
   


   
        <h2>Samrt Spend</h2>
        



    <!-- <div class="flash-message">
         {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash flash-{{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %} -->
  



    <!-- </div>
        <ul>
            <li><a href="{{url_for('dashboard_bp.dashboard')}}">Dashboard</a></li>
            <li><a href="{{url_for('transaction_bp.transaction')}}">Transactions</a></li>
            <li><a href="{{url_for('monthly_bp.monthly')}}">Monthly Budget</a></li>
            <li><a href="{{url_for('report_bp.report_analysis')}}">Reports and Analytics</a></li>
            <li><a href="{{ url_for('reminders_bp.reminders') }}">Reminder</a></li>
            <li><a href="{{url_for('settings_bp.settings')}}">Settings</a></li>
            <li><a href="{{url_for('auth_bp.logout')}}">Logout</a></li>
        </ul>
    </div> -->

    <div class="main-content">

    </div>

    <div class="cards">
        <div class="card green">Total Income :<p> Rs.{{ Total_Income if Total_Income is not none else 0 }}</p> </div>
        <div class="card red">Total Expenses : <p>Rs.{{ Total_expense if Total_expense is not none else 0 }}</p></div>
        <div class="card blue">Remaining Balance : <p>Rs.{{ reamaing_balance }}</p>   
    </div>








 <h2>Expenses by Category</h2>
    <canvas id="myChart" width="300" height="300"></canvas>


<canvas id="myChart" height="150"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>




<script>
fetch('/data')
.then(res => res.json())
.then(data => {
    const ctx = document.getElementById('myChart').getContext('2d');

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: data.months,
            datasets: [
                {
                    label: 'Expenses',
                    data: data.expenses,
                    borderColor: 'rgba(255, 0, 0, 0.8)',
                    backgroundColor: 'rgba(255, 0, 0, 0.3)',
                    fill: true,
                    tension: 0.4  // smooth curve
                },
                {
                    label: 'Income',
                    data: data.income,
                    borderColor: 'rgba(0, 200, 0, 0.8)',
                    backgroundColor: 'rgba(0, 200, 0, 0.3)',
                    fill: true,
                    tension: 0.4
                }
            ]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'bottom' }
            },
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
});
</script>






{% if recent_trans %}
<h2>Recent Transactions</h2>
<table border="1">
    <tr>
        <th>Date</th>
        <th>Type</th>
        <th>Category</th>
        <th>Amount</th>
    </tr>
    
    {% for t in recent_trans %}
    <tr>
        <td>{{ t.date }}</td>
        <td>{{ t.type }}</td>
        <td>{{ t.category }}</td>
        <td>{{ t.amount }}</td>
    </tr>
    {% endfor %}

    {% else %}
    <tr>
        <td colspan="4">No recent transactions found</td>
    </tr>
</table>
{% endif %}


{% endblock  %}

    
</body>
</html>